---
import FormattedDate from "../components/FormattedDate.astro";
import RichText from "../components/rich-text/RichText.tsx";
import Navigation from "../components/Navigation.astro";
import { CalendarFold, Mountain, User } from "@lucide/astro";
import BaseLayout from "./BaseLayout.astro";

interface Props {
  title: string;
  description?: string | null;
  publishedAt: string;
  heroImage: { url: string };
  authors?: any[];
  category?: {
    title: string;
    slug: string;
  };
  categories?: any[];
  content: any;
  slug: string;
  schema?: object;
  ogImage?: string;
}

const {
  title,
  description,
  content,
  publishedAt,
  heroImage,
  authors,
  category,
  categories,
  slug,
  schema,
  ogImage,
} = Astro.props;

// Use description if available, otherwise use title
const postDescription = description || title;

const canonicalUrl = `https://theopenlane.io/blog/${slug}`;
---

<BaseLayout
  title={`${title} | Openlane Blog`}
  description={postDescription}
  image={ogImage}
  canonicalUrl={canonicalUrl}
  schema={schema}
>
  {
    heroImage?.url && (
      <section class="relative w-full">
        <img
          src={ogImage}
          alt={title}
          loading="eager"
          decoding="async"
          class="w-full h-[32vh] md:h-[40vh] lg:h-[50vh] min-h-[220px] max-h-[520px] object-cover"
        />

        <div class="pointer-events-none absolute inset-0">
          <div class="absolute inset-0 bg-black/40" />

          <div class="absolute inset-x-0 top-0 h-40 md:h-52 bg-gradient-to-b from-black/90 via-black/60 to-transparent" />

          <div class="absolute inset-x-0 bottom-0 h-48 md:h-64 bg-gradient-to-t from-black/95 via-black/60 to-transparent" />
        </div>

        <div class="absolute inset-0 flex flex-col">
          <Navigation
            parentNav="News & Industry Insights"
            childNav={title}
            childColorClass="text-white"
          />
        </div>
      </section>
    )
  }

  <section class="py-7 px-6 md:px-12 lg:px-24">
    <div class="max-w-[1230px] mx-auto text-left">
      <div class="mb-20">
        <p
          class="text-xl sm:text-3xl lg:text-5xl font-normal tracking-[-1.2px] text-gradient text-color"
        >
          {title}
        </p>

        <div
          class="mt-3 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-sm"
        >
          {
            Array.isArray(authors) && authors.length > 0 && (
              <div class="flex items-center gap-1 text-color">
                <User size={14} />
                <span>
                  {authors.map((author, index) => (
                    <span key={author?.id}>
                      {author?.name}
                      {index < authors.length - 1 && ", "}
                    </span>
                  ))}
                </span>
              </div>
            )
          }

          <div class="flex items-center gap-1 text-color">
            <CalendarFold size={14} />
            <span>
              {
                new Date(publishedAt).toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })
              }
            </span>
          </div>

          {
            Array.isArray(categories) && categories.length > 0 && (
              <ul class="flex flex-wrap items-center gap-1.5">
                <li class="flex items-center">
                  <Mountain size={14} />
                </li>
                {categories.map((item, index) => (
                  <li
                    key={item?.id ?? item?.slug ?? item?.title}
                    className="py-0.5"
                  >
                    {item?.title}
                    {index < categories.length - 1 && ","}
                  </li>
                ))}
              </ul>
            )
          }
        </div>
      </div>
      <div>
        <RichText client:load data={content} enableGutter={false} />
      </div>
    </div>
  </section>
</BaseLayout>
