---
import BlogPost from "../../layouts/BlogPost.astro";

export async function getStaticPaths() {
  const res = await fetch(`${import.meta.env.PUBLIC_API_URL}/api/posts`);
  const posts = await res.json();

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: post.title,
  description: post.excerpt || post.description,
  image: post.featuredImage || "https://www.theopenlane.io/bolted-on.png",
  datePublished: post.publishedAt || post.createdAt,
  dateModified: post.updatedAt || post.publishedAt || post.createdAt,
  author: {
    "@type": "Person",
    name: post.author?.name || "Openlane Team",
    url: post.author?.url || "https://www.theopenlane.io",
  },
  publisher: {
    "@type": "Organization",
    name: "Openlane",
    url: "https://www.theopenlane.io",
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": `https://www.theopenlane.io/blog/${post.slug}`,
  },
};
---

<BlogPost {...post} schema={schema} />
