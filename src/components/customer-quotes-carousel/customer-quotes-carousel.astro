---
export interface Comment {
  text: string;
  author: string;
  company: string;
  avatarUrl: string;
}

export interface Props {
  comments: Comment[];
}

const { comments } = Astro.props as Props;
const randomComment = comments[Math.floor(Math.random() * comments.length)];
---

<div
  class="relative max-w-2xl rounded-3xl bg-white px-10 py-12 shadow-sm overflow-hidden"
  data-comments={JSON.stringify(comments)}
  data-quote
>
  <img src="/assets/quote.svg" alt="" class="h-12 w-auto" />
  <p data-quote-text class="mt-6 text-[#09151D] text-2xl font-medium leading-8">
    {randomComment.text}
  </p>

  <div class="flex items-center gap-4 mt-8">
    <div class="w-12 h-12 rounded-full overflow-hidden border border-slate-200">
      <img
        data-quote-avatar
        src={randomComment.avatarUrl}
        alt={randomComment.author}
        class="w-full h-full object-cover"
      />
    </div>
    <div class="flex flex-col">
      <span data-quote-author class="text-sm font-medium text-slate-900"
        >{randomComment.author}</span
      >
      <span data-quote-company class="text-sm text-slate-500"
        >{randomComment.company}</span
      >
    </div>
  </div>
</div>

<script>
  function showRandomQuote() {
    const container = document.querySelector("[data-quote]");
    if (!container) return;
    const comments = JSON.parse(
      (container as HTMLElement).dataset.comments || "[]",
    );
    const comment = comments[Math.floor(Math.random() * comments.length)];
    if (!comment) return;

    container.querySelector("[data-quote-text]")!.textContent = comment.text;
    const avatar = container.querySelector(
      "[data-quote-avatar]",
    ) as HTMLImageElement;
    avatar.src = comment.avatarUrl;
    avatar.alt = comment.author;
    container.querySelector("[data-quote-author]")!.textContent =
      comment.author;
    container.querySelector("[data-quote-company]")!.textContent =
      comment.company;
  }

  document.addEventListener("astro:page-load", showRandomQuote);
  document.addEventListener("astro:after-swap", showRandomQuote);
</script>
