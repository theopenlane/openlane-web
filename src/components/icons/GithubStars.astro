---
const repo = "theopenlane/core";
import { Star } from "@lucide/astro";
import GithubIcon from "./GithubIcon.astro";
---

<a
  href={`https://github.com/${repo}`}
  target="_blank"
  rel="noopener noreferrer"
  class="inline-flex items-center gap-1.5 text-sm font-medium text-muted-foreground/70 hover:text-foreground transition-colors"
>
  Github
  <GithubIcon width={18} height={18} />
  <!-- <div class="inline-flex items-center gap-1">
    <span id="star-count" class="tracking-wide star-count"></span>
    <Star size={16} />
  </div> -->
</a>

<script type="module">
  document.addEventListener("astro:page-load", () => {
    const repo = "theopenlane/core";
    const key = `stars:${repo}`;
    const ttlKey = `${key}:ttl`;

    async function fetchStars() {
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}`);
        if (res.ok) {
          const data = await res.json();
          const stars = data.stargazers_count.toLocaleString();
          const ttl = Date.now() + 3600_000;
          sessionStorage.setItem(key, stars);
          sessionStorage.setItem(ttlKey, ttl);
          return stars;
        }
      } catch {}
      return null;
    }

    async function init() {
      let stars = sessionStorage.getItem(key);
      const ttl = Number(sessionStorage.getItem(ttlKey));

      if (!stars || Date.now() > ttl) {
        stars = (await fetchStars()) || "N/A";
      }

      document.getElementById("star-count").textContent = stars;
    }

    init();
  });
</script>
